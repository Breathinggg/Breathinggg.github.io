<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜ç”°é¦¬å ´ ã‚°ãƒ«ãƒ¡ãƒãƒƒãƒ—</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans JP', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f5f5f5;
            color: #333;
        }

        /* Header */
        .header {
            background: #fff;
            padding: 16px 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 18px;
        }

        .logo h1 {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-outline {
            background: #fff;
            color: #667eea;
            border: 1.5px solid #667eea;
        }

        .btn-outline:hover {
            background: #f0f4ff;
        }

        /* Main Layout */
        .main-container {
            display: flex;
            margin-top: 68px;
            height: calc(100vh - 68px);
        }

        /* Sidebar */
        .sidebar {
            width: 380px;
            background: #fff;
            overflow-y: auto;
            box-shadow: 2px 0 8px rgba(0,0,0,0.06);
            flex-shrink: 0;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            position: sticky;
            top: 0;
            background: #fff;
            z-index: 10;
        }

        .search-box {
            display: flex;
            align-items: center;
            background: #f5f5f5;
            border-radius: 10px;
            padding: 12px 16px;
            gap: 10px;
            margin-bottom: 16px;
        }

        .search-box input {
            border: none;
            background: transparent;
            flex: 1;
            font-size: 14px;
            outline: none;
            font-family: inherit;
        }

        .search-icon {
            color: #999;
        }

        /* Filter Tags */
        .filter-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .filter-tag {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1.5px solid #e0e0e0;
            background: #fff;
            color: #666;
        }

        .filter-tag:hover {
            border-color: #667eea;
            color: #667eea;
        }

        .filter-tag.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            border-color: transparent;
        }

        /* Shop List */
        .shop-list {
            padding: 16px;
        }

        .shop-count {
            font-size: 13px;
            color: #888;
            margin-bottom: 12px;
            padding-left: 4px;
        }

        .shop-card {
            background: #fff;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid #f0f0f0;
        }

        .shop-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.08);
            border-color: #667eea;
        }

        .shop-card.active {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .shop-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .shop-name {
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .shop-category {
            font-size: 11px;
            padding: 4px 10px;
            border-radius: 12px;
            background: #f0f4ff;
            color: #667eea;
            font-weight: 500;
        }

        .shop-address {
            font-size: 13px;
            color: #888;
            margin-bottom: 8px;
        }

        .shop-price {
            font-size: 14px;
            color: #667eea;
            font-weight: 500;
        }

        /* Map Container */
        .map-container {
            flex: 1;
            position: relative;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        /* Custom Popup */
        .leaflet-popup-content-wrapper {
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.12);
            padding: 0;
            overflow: hidden;
        }

        .leaflet-popup-content {
            margin: 0;
            min-width: 280px;
            max-width: 320px;
        }

        .popup-content {
            padding: 0;
        }

        .popup-image {
            width: 100%;
            height: 160px;
            object-fit: cover;
        }

        .popup-body {
            padding: 16px;
        }

        .popup-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 8px;
            color: #333;
        }

        .popup-category {
            display: inline-block;
            font-size: 11px;
            padding: 4px 10px;
            border-radius: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            font-weight: 500;
            margin-bottom: 12px;
        }

        .popup-address {
            font-size: 13px;
            color: #888;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .popup-description {
            font-size: 13px;
            color: #555;
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .popup-recommend {
            background: #f8f9ff;
            border-radius: 10px;
            padding: 12px;
        }

        .popup-recommend-title {
            font-size: 12px;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 6px;
        }

        .popup-recommend-content {
            font-size: 13px;
            color: #555;
        }

        .leaflet-popup-tip {
            background: #fff;
        }

        /* Locate Button */
        .locate-btn {
            position: absolute;
            bottom: 24px;
            right: 24px;
            width: 48px;
            height: 48px;
            background: #fff;
            border: none;
            border-radius: 50%;
            box-shadow: 0 4px 16px rgba(0,0,0,0.12);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 500;
            transition: all 0.2s ease;
        }

        .locate-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0,0,0,0.16);
        }

        .locate-btn svg {
            width: 22px;
            height: 22px;
            color: #667eea;
        }

        /* Mobile Styles */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: 0;
                top: 68px;
                bottom: 0;
                width: 100%;
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                z-index: 999;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .map-container {
                width: 100%;
            }

            .header h1 {
                font-size: 16px;
            }

            .mobile-menu-btn {
                display: flex;
                width: 40px;
                height: 40px;
                background: #f5f5f5;
                border: none;
                border-radius: 10px;
                align-items: center;
                justify-content: center;
                cursor: pointer;
            }

            .header-actions .btn-outline {
                display: none;
            }
        }

        @media (min-width: 769px) {
            .mobile-menu-btn {
                display: none;
            }
        }

        /* Loading Animation */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.3s ease;
        }

        .loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #f0f0f0;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Custom Marker */
        .custom-marker {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            width: 32px;
            height: 32px;
            border-radius: 50% 50% 50% 0;
            transform: rotate(-45deg);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .custom-marker-inner {
            width: 12px;
            height: 12px;
            background: #fff;
            border-radius: 50%;
            transform: rotate(45deg);
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading">
        <div class="loading-spinner"></div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="logo">
            <button class="mobile-menu-btn" onclick="toggleSidebar()">
                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 6h18M3 12h18M3 18h18"></path>
                </svg>
            </button>
            <div class="logo-icon">ğŸœ</div>
            <h1>é«˜ç”°é¦¬å ´ ã‚°ãƒ«ãƒ¡ãƒãƒƒãƒ—</h1>
        </div>
        <div class="header-actions">
            <button class="btn btn-outline" onclick="resetView()">ãƒªã‚»ãƒƒãƒˆ</button>
            <button class="btn btn-primary" onclick="locateMe()">ğŸ“ ç¾åœ¨åœ°</button>
        </div>
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="search-box">
                    <svg class="search-icon" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="8" cy="8" r="6"></circle>
                        <path d="M14 14l4 4"></path>
                    </svg>
                    <input type="text" placeholder="åº—èˆ—ã‚’æ¤œç´¢..." id="searchInput" oninput="filterShops()">
                </div>
                <div class="filter-tags" id="filterTags">
                    <span class="filter-tag active" data-category="all">ã™ã¹ã¦</span>
                    <span class="filter-tag" data-category="ä¸­è¯">ä¸­è¯</span>
                    <span class="filter-tag" data-category="ãƒŸãƒ£ãƒ³ãƒãƒ¼">ãƒŸãƒ£ãƒ³ãƒãƒ¼</span>
                    <span class="filter-tag" data-category="éŸ“å›½">éŸ“å›½</span>
                    <span class="filter-tag" data-category="ãƒ™ãƒˆãƒŠãƒ ">ãƒ™ãƒˆãƒŠãƒ </span>
                    <span class="filter-tag" data-category="ãƒ©ãƒ¼ãƒ¡ãƒ³">ãƒ©ãƒ¼ãƒ¡ãƒ³</span>
                    <span class="filter-tag" data-category="ãã®ä»–">ãã®ä»–</span>
                </div>
            </div>
            <div class="shop-list" id="shopList">
                <!-- Shops will be populated by JS -->
            </div>
        </aside>

        <!-- Map -->
        <div class="map-container">
            <div id="map"></div>
            <button class="locate-btn" onclick="locateMe()" title="ç¾åœ¨åœ°ã‚’è¡¨ç¤º">
                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M12 2v4m0 12v4m10-10h-4M6 12H2"></path>
                </svg>
            </button>
        </div>
    </div>

    <script>
        // Shop Data
        const shops = [
            {
                name: "åº§ãƒ»éº»å©†å”åºœ",
                position: [35.7132955, 139.7023077],
                category: "ä¸­è¯",
                address: "é«˜ç”°é¦¬å ´ 4 Chome-11-10",
                description: "ã„ã‚ã„ã‚ãªé£Ÿã¹ç‰©ãŒã‚ã‚Šã€æœ¬å ´ã®å››å·æ–™ç†ã‚’é£Ÿã¹ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚è¾›ã„ã‚‚ã®ãŒè‹¦æ‰‹ãªæ–¹ã§ã‚‚æ¥½ã—ã‚ã‚‹æ–™ç†ãŒè±Šå¯Œã€‚",
                recommend: "ãƒ”ãƒ¼ãƒãƒ³ã¨è±šè¶³ã®ç‚’ã‚ 1200å†† / å”è¾›å­ã¨ç‰›è‚‰ã®ç‚’ã‚ 1200å††",
                price: "1000ã€œ2000å††",
                image: "https://lh5.googleusercontent.com/p/AF1QipPEKOSB6Rm2MySRKLGw81AgllwfNkCSX7BrBgl2=w408-h544-k-no"
            },
            {
                name: "ãƒ¤ãƒãƒ‹ãƒ£",
                position: [35.713536, 139.699622],
                category: "ãƒŸãƒ£ãƒ³ãƒãƒ¼",
                address: "é«˜ç”°é¦¬å ´ 3 Chome-14-16",
                description: "ãƒ–ãƒ•ã‚§ã¯ä¸€äººã§1500å††ã€‚è‡ªåˆ†ãŒå¥½ããªæ–™ç†ã‚‚ãƒ‡ã‚µãƒ¼ãƒˆã‚‚å…¥ã‚Œã¦ã„ã¾ã™ã€‚",
                recommend: "ãƒŸãƒ£ãƒ³ãƒæ–™ç†ã®ãƒãƒ•ã‚§",
                price: "1000ã€œ2000å††",
                image: "https://lh5.googleusercontent.com/p/AF1QipMGXTGmDU85wpYjD4jvkdiXjrBnfVHRKhmyg3LH=w408-h544-k-no"
            },
            {
                name: "è¥¿å®‰ãƒ“ãƒ£ãƒ³ãƒ“ãƒ£ãƒ³éºº",
                position: [35.7121427, 139.6995848],
                category: "ä¸­è¯",
                address: "é«˜ç”°é¦¬å ´ 4-18-9",
                description: "æ–™ç†äººã®æ–¹ãŒéººã‚’ãƒ“ãƒ£ãƒ³ãƒ“ãƒ£ãƒ³å›ã—ã¦ã„ã‚‹ã®ã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚å…·æãŒè±Šå¯Œã§å‘³ã‚‚è‰¯ãã€ä»Šã¾ã§ä½“é¨“ã—ãŸã“ã¨ã®ãªã„éººã®å¤ªã•ã¨å¹³ãŸã•ã§é£Ÿã¹ã”ãŸãˆãŒã‚ã‚Šã¾ã™ã€‚",
                recommend: "ãƒ¨ã‚¦ãƒãƒ¼éºº 900å††",
                price: "800ã€œ1200å††",
                image: "https://lh5.googleusercontent.com/p/AF1QipNM6GvYTlQWPJcGPtIHAG6e4zjd2vj_nHkq8pJJ=w408-h272-k-no"
            },
            {
                name: "æ‹¾å‘³",
                position: [35.7142029, 139.7035291],
                category: "ä¸­è¯",
                address: "é«˜ç”°é¦¬å ´ 3-2-15",
                description: "éå¸¸ã«å¤šãã®ç¨®é¡ã®å®šé£Ÿã‚„æ–™ç†ãŒã‚ã‚Šã€è¾›ã„ã‚‚ã®ã‚’é£Ÿã¹ãªã„äººã‚‚ã“ã“ã§å¥½ããªæ–™ç†ã‚’é£Ÿã¹ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚",
                recommend: "å„ç¨®å®šé£Ÿ",
                price: "1000ã€œ2000å††",
                image: "https://lh5.googleusercontent.com/p/AF1QipNbnit17EDyzhpB7-oZRZkwnl85u-y9FjRO5sr0=w408-h306-k-no"
            },
            {
                name: "å­™äºŒå¨˜è··è„šç‰›è‚‰",
                position: [35.712990, 139.700571],
                category: "ä¸­è¯",
                address: "é«˜ç”°é¦¬å ´ 3-12-11",
                description: "ç‰›è‚‰ã‚¹ãƒ¼ãƒ—ã¯ã€ã‚·ãƒ³ãƒ—ãƒ«ã§ã¨ã¦ã‚‚å¥åº·ã«è‰¯ã„ãŠå‘³ã€‚å¹²ã—è±†è…ã‚„å¤§æ ¹åƒåˆ‡ã‚Šã¯ã€é£Ÿã¹ã‚„ã™ãã€äººã‚’é¸ã°ãªã„ã®ã§ã€ã¡ã‚‡ã£ã¨ã—ãŸãŠã‹ãšã«ãƒ”ãƒƒã‚¿ãƒªã€‚",
                recommend: "ã‚¹ãƒ¼ãƒ—ï¼‹ãƒ©ã‚¤ã‚¹ 1050å††",
                price: "1000ã€œ1500å††",
                image: "https://lh5.googleusercontent.com/p/AF1QipMz1odz9crQfmG6cAXfTsPdNd6M5WRWGPHjUsNw=w408-h487-k-no"
            },
            {
                name: "NEW YORKER'S Cafe",
                position: [35.7115791145019, 139.70400795937874],
                category: "ãã®ä»–",
                address: "é«˜ç”°é¦¬å ´ 1-33-13",
                description: "å‹‰å¼·ã™ã‚‹æ™‚ã«é©åˆ‡ã€‚è‰²ã‚“ãªé£Ÿã¹ç‰©ã€é£²ã¿ç‰©ã‚ã‚Šã€‚WI-FIï¼å–«ç…™åŒºåŸŸã‚ã‚Šã€‚",
                recommend: "å„ç¨®ãƒ‰ãƒªãƒ³ã‚¯ãƒ»è»½é£Ÿ",
                price: "500ã€œ1000å††",
                image: "https://lh5.googleusercontent.com/p/AF1QipN-dCwpM6PJfVgdPV54eURLnCOVb_nOGsQdyk4n=w408-h291-k-no"
            },
            {
                name: "è€å››å·éººé¤¨ é‘«æº€è»’",
                position: [35.7130, 139.7010],
                category: "ä¸­è¯",
                address: "é«˜ç”°é¦¬å ´ 3-12-11",
                description: "åº—å“¡ã•ã‚“ã¯ã€ã¨ã¦ã‚‚æ—¥æœ¬èªãŒãŠä¸Šæ‰‹ã§ã¨ã¦ã‚‚ãŠå„ªã—ã„æ–¹ãŸã¡ã€‚æœ¬æ ¼å››å·æ–™ç†ãŒæ¥½ã—ã‚ã¾ã™ã€‚",
                recommend: "å„ç¨®å››å·æ–™ç†",
                price: "1000ã€œ1500å††",
                image: "https://lh5.googleusercontent.com/p/AF1QipOYHWA0-Rc8l7mau31YGPoHZyKYsnR1SID-1BY=w408-h544-k-no"
            },
            {
                name: "Shwe Ba Ba",
                position: [35.7125910, 139.7000667],
                category: "ãƒŸãƒ£ãƒ³ãƒãƒ¼",
                address: "é«˜ç”°é¦¬å ´ 3-12-8",
                description: "æ–™ç†ã¯ç¾å‘³ã—ãã¦å€¤æ®µã‚‚ã¡ã‚‡ã†ã©ã„ã„ã§ã™ã€‚åº—ã®äººã‚‚å„ªã—ãã¦ã‚µãƒ¼ãƒ“ã‚¹ã‚‚ã„ã„ã§ã™ã€‚",
                recommend: "ã‚¹ãƒãƒ¼ãƒ‘ãƒ¼ãƒ«ãŠã“ã‚",
                price: "850ã€œ2000å††",
                image: "https://lh5.googleusercontent.com/p/AF1QipO5tuBgbn_IklG9Q8Hm3uKb-AXlxzU1zyDjbqUD=w408-h544-k-no"
            },
            {
                name: "ãƒ¬ã‚¤ã‚¹ã‚±ãƒãƒ–é«˜ç”°é¦¬å ´åº—",
                position: [35.7117874, 139.7077264],
                category: "ãã®ä»–",
                address: "é«˜ç”°é¦¬å ´ 1-6-15",
                description: "ãƒˆãƒ«ã‚³ç™ºç¥¥ã®æ–™ç†ã€‚ä¸–ç•Œä¸­ã§æ„›ã•ã‚Œã¦ãŠã‚Šã€ç•°æ–‡åŒ–äº¤æµã®ãã£ã‹ã‘ã«ã‚‚ãªã‚Šã¾ã™ã€‚",
                recommend: "ãƒˆãƒ«ã‚³ã®ç„¼ãè‚‰",
                price: "300ã€œ500å††",
                image: "https://lh5.googleusercontent.com/p/AF1QipNrBVdbSnS5paKskIDNtZDpASe0_10iimRZV41G=w408-h305-k-no"
            },
            {
                name: "Arum Korean Restaurant",
                position: [35.714685866685116, 139.70279320486736],
                category: "éŸ“å›½",
                address: "é«˜ç”°é¦¬å ´ 3 Chome-4-17",
                description: "é‡ãŒå¤šãã¦ã€ç‰›ä¸¼ã‚»ãƒƒãƒˆã®æµ·é®®æ¹¯ã¯ã‚ã£ã¡ã‚ƒç¾å‘³ã—ã„ã€‚",
                recommend: "ç‰›ä¸¼ã‚»ãƒƒãƒˆ",
                price: "1200ã€œ2000å††",
                image: "https://lh5.googleusercontent.com/p/AF1QipNXei2gU-8I_pjdOp4mzdNE9kfkea8oHJHkaA0K=w408-h408-k-no"
            },
            {
                name: "Banh Mi Ngon Ngon",
                position: [35.71270401740903, 139.70044634412048],
                category: "ãƒ™ãƒˆãƒŠãƒ ",
                address: "é«˜ç”°é¦¬å ´ 4 Chome-17-15",
                description: "ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãªãƒ•ã‚©ãƒ¼ã§ã™ã€‚",
                recommend: "ãƒ•ã‚©ãƒ¼",
                price: "1100å††ã€œ",
                image: "https://lh5.googleusercontent.com/p/AF1QipPkUG2TML94MKp-EuVav8_-h09j1E2JTkTUpL2a=w425-h240-k-no"
            },
            {
                name: "éººå±‹æ­¦è”µ é·¹è™",
                position: [35.7141023571538, 139.70446882205462],
                category: "ãƒ©ãƒ¼ãƒ¡ãƒ³",
                address: "é«˜ç”°é¦¬å ´ 2 Chome-19-7",
                description: "ã‚¹ãƒ‘ã‚¤ã‚·ãƒ¼ã§é‡ãŒå¤šã„ã€‚",
                recommend: "è¾›ã„ãƒ©ãƒ¼ãƒ¡ãƒ³/ã¤ã‘éºº",
                price: "1150å††ã€œ",
                image: "https://lh5.googleusercontent.com/p/AF1QipM8RDf-f19YbN1J5JUQP_BAhve8ybhgulJDEClN=w408-h272-k-no"
            },
            {
                name: "å››å·ç«é‹ è³¢åˆåº„",
                position: [35.7136266, 139.7035030],
                category: "ä¸­è¯",
                address: "é«˜ç”°é¦¬å ´ 4-8-7 ä¸‰éš",
                description: "ç«é‹ã‚’å›²ã‚“ã§å‹äººã¨æ¥½ã—ã‚€ã“ã¨ãŒã§ãã‚‹ã€‚è¾›ã„ã‚¹ãƒ¼ãƒ—ã‚‚é¸æŠå¯èƒ½ã€‚",
                recommend: "é£Ÿã¹æ”¾é¡Œ 4600å†† / é£²ã¿æ”¾é¡Œ 1500å††",
                price: "4000ã€œ6000å††",
                image: "https://lh5.googleusercontent.com/p/AF1QipNk2B4dkYA05hBzt5g0KxJ3ZgmbRu6-cHmoYgU4=w480-h240-k-no"
            },
            {
                name: "ãƒŸãƒ£ ãƒŸã‚£ãƒ³ ãƒ¢",
                position: [35.713937, 139.704460],
                category: "ãƒŸãƒ£ãƒ³ãƒãƒ¼",
                address: "é«˜ç”°é¦¬å ´ 2 Chome-19-7 TAK11 2F",
                description: "ãƒŸãƒ£ãƒ³ãƒãƒ¼æ–™ç†ã«èˆˆå‘³ãŒã‚ã‚‹æ–¹ã«ã¯ãŠã™ã™ã‚ã€‚ã‚¹ãƒ‘ã‚¤ã‚¹ã®è¾›ã•ã¨ç‹­ã„ã‚¹ãƒšãƒ¼ã‚¹ã«ã¯æ³¨æ„ã€‚",
                recommend: "ã†ãšã‚‰ã®å”æšã’ã€ãƒ©ãƒšãƒƒãƒˆã‚¥",
                price: "800ã€œ1500å††",
                image: "https://lh5.googleusercontent.com/p/AF1QipM2QdVaed7oEMZ6xB8mXSw461F0YoBluLW308g=w408-h306-k-no"
            },
            {
                name: "ãƒŸãƒ³ã‚¬ãƒ©ãƒãƒ¼",
                position: [35.714000, 139.705014],
                category: "ãƒŸãƒ£ãƒ³ãƒãƒ¼",
                address: "é«˜ç”°é¦¬å ´ 2 Chome-18-6 æŸ³å±‹ãƒ“ãƒ« B1F",
                description: "ãƒŸãƒ£ãƒ³ãƒãƒ¼æ–™ç†ã®ä¸­ã§ã‚‚ç‰¹ã«æ³¨ç›®ã™ã¹ãåº—ã€‚æ–™ç†ã¯ã„ã¤ã‚‚ã¨ã¦ã‚‚ç¾å‘³ã—ã„ã€‚",
                recommend: "ãƒ¢ãƒ’ãƒ³ã‚¬ 1000å††",
                price: "800ã€œ1500å††",
                image: "https://lh5.googleusercontent.com/p/AF1QipMEraLIbIbKisoazALTf4XtrDEUGiRgG1PxGnRE=w408-h306-k-no"
            },
            {
                name: "ã¯ã¾å¯¿å¸",
                position: [35.7122838, 139.7075319],
                category: "ãã®ä»–",
                address: "é«˜ç”°é¦¬å ´ 2ä¸ç›®13",
                description: "æ‰‹é ƒãªä¾¡æ ¼ã¨å¤šæ§˜ãªãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€‚",
                recommend: "å„ç¨®å¯¿å¸",
                price: "1000ã€œ2000å††",
                image: "https://lh5.googleusercontent.com/p/AF1QipP8VW24vKMOFU9qy3vftHkz3IUEP7YGhiUoO81l=w408-h305-k-no"
            },
            {
                name: "ã¨ã‚“ã‹ã¤ ã¨ã‚“ä¹…",
                position: [35.7127504027299, 139.70516305433884],
                category: "ãã®ä»–",
                address: "é«˜ç”°é¦¬å ´ 1 Chome-26-5",
                description: "è‚‰ãŒæŸ”ã‚‰ã‹ãã€é‡ãŒå¤šã„ã€‚è³ªã®é«˜ã„ã¨ã‚“ã‹ã¤ã€‚",
                recommend: "ãƒ’ãƒ¬ã‹ã¤ 1250å†† / ãƒ­ãƒ¼ã‚¹ã‹ã¤ 1300å††",
                price: "1200ã€œ1500å††",
                image: "https://lh5.googleusercontent.com/p/AF1QipPYzQbwbUZRnJVyK_lGQ0y1tkoIVRAaaToFw2Y=w408-h306-k-no"
            }
        ];

        // Global variables
        let map;
        let markers = [];
        let activeCategory = 'all';
        let userMarker = null;

        // Custom marker icon
        const shopIcon = L.divIcon({
            className: 'custom-marker-container',
            html: '<div class="custom-marker"><div class="custom-marker-inner"></div></div>',
            iconSize: [32, 32],
            iconAnchor: [16, 32],
            popupAnchor: [0, -32]
        });

        const userIcon = L.icon({
            iconUrl: "https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png",
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowUrl: "https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png",
            shadowSize: [41, 41]
        });

        // Initialize map
        function initMap() {
            map = L.map('map', {
                zoomControl: false
            }).setView([35.7128, 139.7036], 16);

            L.control.zoom({ position: 'topright' }).addTo(map);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: 'Â© OpenStreetMap'
            }).addTo(map);

            // Add area boundary
            const bounds = [[35.7100, 139.6970], [35.7160, 139.7100]];
            L.rectangle(bounds, {
                color: "#667eea",
                weight: 2,
                fill: true,
                fillOpacity: 0.05,
                dashArray: '5, 5'
            }).addTo(map);

            // Add markers
            shops.forEach((shop, index) => {
                const marker = L.marker(shop.position, { icon: shopIcon }).addTo(map);

                const popupContent = `
                    <div class="popup-content">
                        <img src="${shop.image}" alt="${shop.name}" class="popup-image" onerror="this.style.display='none'">
                        <div class="popup-body">
                            <div class="popup-title">${shop.name}</div>
                            <span class="popup-category">${shop.category}</span>
                            <div class="popup-address">
                                <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                    <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"></path>
                                    <circle cx="12" cy="9" r="2.5"></circle>
                                </svg>
                                ${shop.address}
                            </div>
                            <div class="popup-description">${shop.description}</div>
                            <div class="popup-recommend">
                                <div class="popup-recommend-title">âœ¨ ã‚ªã‚¹ã‚¹ãƒ¡</div>
                                <div class="popup-recommend-content">${shop.recommend}<br><strong>${shop.price}</strong></div>
                            </div>
                        </div>
                    </div>
                `;

                marker.bindPopup(popupContent, {
                    maxWidth: 320,
                    minWidth: 280
                });

                marker.shopData = shop;
                marker.shopIndex = index;
                markers.push(marker);
            });

            renderShopList();
            setupFilterTags();

            // Hide loading
            setTimeout(() => {
                document.getElementById('loading').classList.add('hidden');
            }, 500);
        }

        // Render shop list
        function renderShopList() {
            const container = document.getElementById('shopList');
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();

            const filteredShops = shops.filter(shop => {
                const matchesCategory = activeCategory === 'all' || shop.category === activeCategory;
                const matchesSearch = shop.name.toLowerCase().includes(searchTerm) ||
                                     shop.description.toLowerCase().includes(searchTerm);
                return matchesCategory && matchesSearch;
            });

            document.querySelector('.shop-count') ?. remove();

            let html = `<div class="shop-count">${filteredShops.length} ä»¶ã®åº—èˆ—</div>`;

            filteredShops.forEach((shop, index) => {
                const originalIndex = shops.indexOf(shop);
                html += `
                    <div class="shop-card" onclick="focusShop(${originalIndex})" data-index="${originalIndex}">
                        <div class="shop-card-header">
                            <div class="shop-name">${shop.name}</div>
                            <span class="shop-category">${shop.category}</span>
                        </div>
                        <div class="shop-address">${shop.address}</div>
                        <div class="shop-price">${shop.price}</div>
                    </div>
                `;
            });

            container.innerHTML = html;

            // Update marker visibility
            markers.forEach((marker, index) => {
                const shop = shops[index];
                const matchesCategory = activeCategory === 'all' || shop.category === activeCategory;
                const matchesSearch = shop.name.toLowerCase().includes(searchTerm) ||
                                     shop.description.toLowerCase().includes(searchTerm);

                if (matchesCategory && matchesSearch) {
                    marker.addTo(map);
                } else {
                    map.removeLayer(marker);
                }
            });
        }

        // Setup filter tags
        function setupFilterTags() {
            document.querySelectorAll('.filter-tag').forEach(tag => {
                tag.addEventListener('click', () => {
                    document.querySelectorAll('.filter-tag').forEach(t => t.classList.remove('active'));
                    tag.classList.add('active');
                    activeCategory = tag.dataset.category;
                    renderShopList();
                });
            });
        }

        // Filter shops
        function filterShops() {
            renderShopList();
        }

        // Focus on shop
        function focusShop(index) {
            const marker = markers[index];
            const shop = shops[index];

            map.setView(shop.position, 17);
            marker.openPopup();

            // Update active state
            document.querySelectorAll('.shop-card').forEach(card => card.classList.remove('active'));
            document.querySelector(`.shop-card[data-index="${index}"]`)?.classList.add('active');

            // Close sidebar on mobile
            if (window.innerWidth <= 768) {
                document.getElementById('sidebar').classList.remove('open');
            }
        }

        // Locate user
        function locateMe() {
            if (!navigator.geolocation) {
                alert("ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ä½ç½®æƒ…å ±ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚");
                return;
            }

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const { latitude, longitude } = position.coords;

                    if (userMarker) {
                        map.removeLayer(userMarker);
                    }

                    userMarker = L.marker([latitude, longitude], { icon: userIcon }).addTo(map);
                    userMarker.bindPopup("ğŸ“ ç¾åœ¨åœ°").openPopup();
                    map.setView([latitude, longitude], 16);
                },
                () => {
                    alert("ä½ç½®æƒ…å ±ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚");
                }
            );
        }

        // Reset view
        function resetView() {
            map.setView([35.7128, 139.7036], 16);
            document.querySelectorAll('.filter-tag').forEach(t => t.classList.remove('active'));
            document.querySelector('.filter-tag[data-category="all"]').classList.add('active');
            activeCategory = 'all';
            document.getElementById('searchInput').value = '';
            renderShopList();
        }

        // Toggle sidebar (mobile)
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', initMap);
    </script>
</body>
</html>
